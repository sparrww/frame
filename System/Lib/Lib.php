<?php/******************************************************************* * @authors Air * @date    2014-09-06 * @copy    Copyright © 2013-2018 Powered by Air Web Studio   *******************************************************************/// 加载namespace Lib;class Lib{	static protected $_instance = NULL;	/**	 * 运行	 *	 * @access public     * @return bool	 */	public function run(){		$path = rtrim($_SERVER["SCRIPT_NAME"],'/');		$param = $_GET = self::parse_path($path);		spl_autoload_register(array('Lib\Lib', '__autoload'));		try {			// 类名不存在，使用默认类名			if(class_exists($param['controller'])){                 $this->controller = new $param['controller'];				//方法不存在，使用默认方法			   if(method_exists($this->controller, $param['operate'])){						return $this->controller->$param['operate']();				}else{					throwexce(sprintf('%s is not found in the %s!',$param['operate'], $param['controller']));				}			}else{				throwexce(sprintf('%s Object does not exist!', $param['controller']));			}        } catch (Exceptions $e) {            systemerror($e);        }                self::_header();	}	/**	 * 自动加载类方法	 *	 * @access	private	 * @static	 * @param	string	$class_name	 * @return	string	 */    final public static function __autoload($class_name) {				//控制器文件调用		$controller_file = MODULE_PATH.'/'.str_replace('\\', '/', $class_name).'.php';		//验证控制器		if(file_exists($controller_file)) {			require_once($controller_file);	   }else{			 throwexce(sprintf('%s File does not exist!', $controller_file));	   }	}	/**	 * 解析URL路径	 * 	 * @return void	 * @access private	 *	 */	private static function parse_path($string){		if (empty($string)) throwexce("No setup directory.");		list($path, $param) = explode("?", $_SERVER["PHP_SELF"]);		$param = explode("/",str_replace($string, '', $path));		$array['module'] = ($param[1]?$param[1]:C("DEFAULT_MODULE"));		$array['controller'] = str_replace('/', '\\',($param[2]?$param[1].'/'.CONTROLLER.'/'.$param[2]:str_replace('Home',ucwords($array['module']),C("DEFAULT_CONTROLLER"))).CONTROLLER);		$array['operate'] = ($param[3]?$param[3]:'index');		for ($i=4;$i<count($param);$i++) {			$array[$param[$i]] = $param[++$i];		}		return array_filter($array);	}	/**	 * 程序结束输出 header	 *	 * @access private	 * @static	 * @return void	 */    final private static function _header(){			// 程序必须开启缓冲区    		ob_start();            header('X-Powered-By: Worker/'. VERSION . ' (AirPHP)');            header('X-Run-Period: '.(microtime(true) - __BEGIN__));            // 清理缓冲区，输出到浏览器            ob_end_flush(); flush();        }	/**	 * 程序结束输出 header	 *	 * @access private	 * @static	 * @return void	 * demo $aa=Lib\Lib::getinstance()->A('class',Null,'Controller')->index();	 */    public function A($funcName,$array="",$ext=CONTROLLER){    	$definition = $funcName.$ext;		$funcFile=ROOT_PATH.'/Module/'.str_replace('\\','/',$funcName.$ext).'.php';		 if(file_exists($funcFile)){			include_once $funcFile;			if(class_exists($definition)){				return new $definition($array);			}else{				throwexce(sprintf('%s Class does not exist!', $funcName));			}		}else{				return new model(implode(',',$array));		}    }	/**     *  静态方法, 单例统一访问入口	 * 	 *  @access	public 	 *  @static     *  @return  object  返回对象的唯一实例     */	static public function getinstance() {			if (is_null(self::$_instance) || !isset(self::$_instance)) {				self::$_instance = new self();			}			return self::$_instance;	}}?>